# Account Information Downloader

遠隔地の新入生に，大学の情報システムを利用するためのユーザ名を通知する目的で作成した CGI です．

大学事務局と新入生で共有している秘密情報（受験番号や生年月日，指導教員名など）のエントロピーが小さいため，これらの秘密情報を使って暗号化したファイルをメールに添付して送付すると，メールを傍受した第3者に総当たり攻撃によって解読される可能性があるという状況です．この状況を緩和するため，何回か試行が失敗した段階で，それ以上の試行を拒否するようにします．

## Limitation

上記の通り，この CGI は単なる緩和策であり，*安全に秘密情報を通知することはできません*．通知対象が必要とする安全性と，この CGI が破られる確率とを，十分に吟味して使ってください．

筆者の場合は，

* 新入生のメールアドレス
* 新入生の生年月日
* 指導教員名

が正確に入力された場合に，ユーザ名を通知するようにしています．指導教員名は1000名の名簿から選ぶように設定し，かつ，5回失敗すると通知を拒否するように設定しています．したがって，指導教員名を知らない第3者（攻撃対象の新入生のメールアドレスと生年月日は知っているものとする）が，ユーザ名を取り出すことができる確率は0.5%です．

ユーザ名が第3者に知られると，アカウント乗っ取りの可能性が高まりますから，あまり第3者に知られたくはありません．しかし，ユーザ名は基本的にはオープンな情報であり，完全に秘匿することは不可能です．というような状況で，*ほどほどに安全に通知したい* という中途半端な目的のために，この CGI を作成しました．

## Usage

最初に，新入生の本人確認のために使う情報のフィールド名を `downloader.ini` に記入してください．

```
[default]
primarykey=mail
identificationkeys=birthday, supervisor
```

新入生を区別するための一意な情報のフィールド名を `primarykey` オプションに，その新入生の本人確認のために使う情報のフィールド名を `identificationkeys` オプションに記入してください．

次に，新入生に通知する情報のテンプレートを `check.tmpl` に用意して，新入生に通知する情報のフィールド名を決めてください．

```
Your login name is <code><TMPL_VAR name="username"></code>.
```

のように書いた場合は，通知する情報のフィールド名は `username` となります．

通知する新入生の名簿を `accounts.csv` に用意してください．1行目はフィールド名で，2行目からがデータ本体です．本人確認のために使う情報（`primarykey` オプションおよび `identificationkeys` オプション）のフィールドと，新入生に通知する情報のフィールドは，必ず必要です．

指導教員名簿を `faculties.csv` に用意してください．これも，1行目はフィールド名で，2行目からがデータ本体です．

本人確認のために使う情報を入力するためのテンプレートを `start.tmpl` に用意してください．指導教員名簿のフィールド名は，このテンプレートによって決まっています．

```
<select id="supervisor" name="supervisor">
<option value="">Select your supervisor</option>
<TMPL_LOOP name="faculties"><option value="<TMPL_VAR name="name">"><TMPL_VAR name="name"></option>
</TMPL_LOOP>
</select>
```

ファイル名を変更したい場合は，`downloader.ini` を適宜に変更してください．

## License

GPL3.
